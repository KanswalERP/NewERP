@using NtierMvc.Model
@using NtierMvc.Infrastructure

@model NtierMvc.Model.OrderEntity
@{
    ViewBag.Title = "Order";
}

<div class="row mt-3">
    <div class="col-md-2">
        <button id="btnAddOrder" type="button" class="btn btn-outline-primary btn-sm" style="float: left;" ng-click="BindOrderPopup()"><i class="fa fa-plus"></i><b> Add Master Order</b></button>
        <button id="btnAddItem" type="button" class="btn btn-outline-primary btn-sm" style="float: left;" ng-click="BindItemPopup()"><i class="fa fa-plus"></i><b> Add Item Wise Order</b></button>
    </div>
    <div class="col-md-8">
        <div class="row text-center">
            <div class="col-md-2">
                <label>Quote Type</label>
            </div>
            <div class="col-md-2">
                <label>Quote No</label>
            </div>
            <div class="col-md-2">
                <label>Vendor ID</label>
            </div>
            <div class="col-md-2">
                <label>Vendor Name</label>
            </div>
            <div class="col-md-2">
                <label>Product Group</label>
            </div>
            <div class="col-md-2">
                <label>Order For</label>
            </div>
            <div class="col-md-2">
                <label></label>
            </div>
        </div>
    </div>
</div>

<div class="row">
    <div class="col-md-2">
    </div>
    <div class="col-md-8">
        <div class="row">
            <div class="col-md-2">
                <div class="input-group">
                    @Html.DropDownList("QuoteType", new SelectList(@ViewBag.ListQuoteType, "DataStringValueField", "DataTextField", "Select"),
                           new
                           {
                               @class = "form-control",
                               @id = "SearchOrderQuoteType",
                               ng_model = "SearchOrderQuoteType",
                               @onchange = "GetQuoteNoListForPartialOrders()"
                           })
                </div>
            </div>
            <div class="col-md-2">
                <div class="input-group">
                    @Html.DropDownList("QuoteNo", new SelectList(@ViewBag.ListQuoteNo, "DataStringValueField", "DataTextField", "Select"),
                           new
                           {
                               @id="SearchOrderQuoteNo",
                               @class = "form-control",
                               ng_model = "SearchOrderQuoteNo"
                           })
                </div>
            </div>
            <div class="col-md-2">
                <div class="input-group">
                    @Html.DropDownList("VendorId", new SelectList(@ViewBag.ListVendorId, "DataStringValueField", "DataTextField", "Select"),
                           new
                           {
                               @class = "form-control",
                               ng_model = "SearcOrderVendorID"
                           })
                </div>
            </div>
            <div class="col-md-2">
                <div class="input-group">
                    @Html.DropDownList("VendorName", new SelectList(@ViewBag.ListVendorName, "DataStringValueField", "DataTextField", "Select"),
                           new
                           {
                               @class = "form-control",
                               ng_model = "SearchOrderVendorName"
                           })
                </div>
            </div>
            <div class="col-md-2">
                <div class="input-group">
                    @Html.DropDownList("ProductGroup", new SelectList(@ViewBag.ListProdGrp, "DataStringValueField", "DataTextField", "Select"),
                           new
                           {
                               @class = "form-control",
                               ng_model = "SearchOrderProductGroup"
                           })
                </div>
            </div>
            <div class="col-md-2">
                <div class="input-group">
                    @Html.DropDownList("EnqFor", new SelectList(@ViewBag.ListEnqFor, "DataStringValueField", "DataTextField", "Select"),
                           new
                           {
                               @class = "form-control",
                               ng_model = "SearchOrderEnqFor"
                           })
                </div>
            </div>
            <div class="input-group-btn col-md-2">
                <button class="btn btn-link" type="button" id="btnSearch" ng-click="FetchOrdersList()">
                    <i class="fa fa-search"></i>
                </button>
            </div>
        </div>
    </div>
</div>
<div class="row mt-1">
    <div class="col-md-12">

    </div>
</div>


<div class="wrapper">
    <div class="container">
        <table class="text-center">
            <thead class="tblhead">
                <tr>
                    <th>
                        Action
                        <div class="c1">
                            Action
                        </div>
                    </th>
                    <th>
                        SO No
                        <div class="c2">
                            SO No
                        </div>
                    </th>
                    <th>
                        PO Entity
                        <div class="c2">
                            PO Entity
                        </div>
                    </th>
                    <th>
                        PO Location
                        <div class="c3">
                            PO Location
                        </div>
                    </th>
                    <th>
                        PO No
                        <div class="c3">
                            PO No
                        </div>
                    </th>
                    <th>
                        PO Date
                        <div class="c3">
                            PO Date
                        </div>
                    </th>
                    <th>
                        Currency
                        <div class="c3">
                            Currency
                        </div>
                    </th>
                    <th>
                        ExWorkValue
                        <div class="c3">
                            ExWorkValue
                        </div>
                    </th>
                    <th>
                        PO Delivery Date
                        <div class="c3">
                            PO Delivery Date
                        </div>
                    </th>
                    <th>
                        Consignee Name
                        <div class="c3">
                            Consignee Name
                        </div>
                    </th>
                    <th>
                        Consignee Location
                        <div class="c3">
                            Consignee Location
                        </div>
                    </th>
                </tr>
            </thead>
            <tbody>
                <tr ng-repeat="L in AvailableOrdersList">
                    <td>
                        <button type="button" class="btn btn-outline-primary btn-sm" data-toggle="tooltip" data-placement="bottom" title="VIEW" ng-click="LoadOrderViewPopup(L.Id)">
                            <i class="fa fa-eye"></i>
                        </button>
                        <button type="button" class="btn btn-outline-primary btn-sm" data-toggle="tooltip" data-placement="bottom" title="EDIT" ng-click="LoadOrderEditPopup(L.Id)">
                            <i class="fa fa-edit"></i>
                        </button>
                        @*<button type="button" class="btn btn-outline-danger btn-sm" data-toggle="tooltip" data-placement="bottom" title="DELETE" ng-click="DeleteOrder(L.Id)">
                <i class="fa fa-trash"></i>
            </button>*@
                    </td>
                    <td>
                        {{L.SoNo}}
                    </td>
                    <td>
                        {{L.PoEntity}}
                    </td>
                    <td>
                        {{L.PoLocation}}
                    </td>
                    <td>
                        {{L.PoNo}}
                    </td>
                    <td>
                        {{L.PoDate}}
                    </td>
                    <td>
                        {{L.Curr}}
                    </td>
                    <td>
                        {{L.ExWorkValue}}
                    </td>
                    <td>
                        {{L.PoDeliveryDate}}
                    </td>
                    <td>
                        {{L.ConsigneeName}}
                    </td>
                    <td>
                        {{L.ConsigneeLocation}}
                    </td>
                </tr>
            </tbody>
            <tfoot>
                <tr>
                    <td>
                        <div class="c1">
                            <div class="row p-0">
                                <div class="col-md-2 p-0">
                                    <span class="form-group pull-left page-size form-inline">
                                        <b>Records per page : &nbsp;&nbsp;</b>
                                        <select id="ddlorderPageSize" class="form-control control-color"
                                                ng-model="orderPageSize"
                                                ng-change="OrderChangePageSize()">
                                            <option value="100000">All</option>
                                            <option value="5">5</option>
                                            <option value="10">10</option>
                                            <option value="25">25</option>
                                            <option value="50">50</option>
                                            <option value="100">100</option>
                                        </select>
                                    </span>
                                </div>
                                <div class="col-md-8 pull-right p-0">
                                    <div class="row p-0">
                                        <div class="col-md-10 p-0">
                                            <pagination total-items="orderTotalCount" ng-change="OrderPageChanged()" items-per-page="orderPageSize" direction-links="true" ng-model="orderPageIndex" max-size="maxsize" class="pagination pull-right" boundary-links="true" rotate="false" num-pages="orderNumPages"></pagination>
                                        </div>
                                        <div class="col-md-2 p-0">
                                            <a class="btn btn-primary p-2 pull-right">Page: {{orderPageIndex}} / {{orderNumPages}}</a>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </td>

                </tr>
            </tfoot>
        </table>
    </div>
</div>

<div class="modal" id="addOrderDetails" tabindex="-1" role="dialog">
    @*@using (Ajax.BeginForm(actionName: "SaveOrderDetails", controllerName: "Technical", ajaxOptions: new AjaxOptions
        {
            HttpMethod = "POST"
            // OnSuccess = "BuildingSpaceDetails.UploadFiles"
        },
                routeValues: null,
                htmlAttributes: new { id = "frmOrderDetails" }))
        {*@
    <div class="modal-dialog" style="width:80%; max-width: 80%;" role="document">
        <div class="modal-content">
            <div class="modal-header">
                @*@Html.HiddenFor(m => m.TrnBuildingHdrId)*@
                <h5 class="modal-title">Add Order Details</h5>
                <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                    <span aria-hidden="true">&times;</span>
                </button>
            </div>
            <div id="div-Staff-details" class="modal-body">

            </div>
            <div class="modal-footer">
                <button type="submit" id="btnSubmit" class="btn btn-primary">Save</button>
                <button type="button" class="btn btn-secondary" data-dismiss="modal">Close</button>
            </div>
        </div>
    </div>
    @*}*@
</div>


<div class="modal fade" id="add_details" tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel" aria-hidden="true">
</div>


<div class="modal fade" id="registor-Sucess-Failure" tabindex="-1" role="dialog" aria-hidden="true" data-backdrop="static" data-keyboard="false">
    <div class="modal-dialog" role="document">
        <div class="modal-content">
            <div class="modal-header">
                <h6 class="modal-title">Notification</h6>
                <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                    <span aria-hidden="true">&times;</span>
                </button>
            </div>
            <div class="modal-body">
                <form>
                    <div class="row">
                        <div class="col-md-12">
                            <div class="form-group">
                                &nbsp;&nbsp;<span id="spn-registor-Sucess-Failure"></span><span id="spnUserName" style="font-weight:bold"></span>&nbsp;&nbsp;<span id="spnUserNameMore"></span>
                            </div>
                        </div>
                    </div>
                </form>
            </div>
            <div class="modal-footer">
                <button type="button" data-dismiss="modal" class="btn btn-primary">OK</button>
            </div>
        </div>
    </div>
</div>


<div class="modal fade" id="Sucess-Failure" tabindex="-1" role="dialog" aria-hidden="true" data-backdrop="static" data-keyboard="false">
    <div class="modal-dialog" role="document">
        <div class="modal-content">
            <div class="modal-header">
                <h6 class="modal-title">Notification</h6>
                <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                    <span aria-hidden="true">&times;</span>
                </button>
            </div>
            <div class="modal-body">
                <form>
                    <div class="row">
                        <div class="col-md-12">
                            <div class="form-group row">
                                &nbsp;&nbsp;<span id="spn-Sucess-Failure"></span>
                            </div>
                        </div>
                    </div>
                </form>
            </div>
            <div class="modal-footer">
                <button type="button" data-dismiss="modal" class="btn btn-primary">OK</button>
            </div>
        </div>
    </div>
</div>
<script type="text/javascript">

    $(document).ready(function () {
        window.OrderDetailsPopup = '@Url.Action("OrderPopup", "Technical")';
        window.DeleteOrderDetail = '@Url.Action("DeleteOrderDetail", "Technical")';
        window.ItemDetailsPopup = '@Url.Action("ItemPopup", "Technical")';
        window.GetPrepQuoteNo = '@Url.Action("GetPrepQuoteNo", "Technical")';
    });

    function GetQuoteNoListForPartialOrders() {

        let QuoteType = $('#SearchOrderQuoteType').val();

        $.ajax({
            type: 'POST',
            url: window.GetPrepQuoteNo,
            data: JSON.stringify({ quotetypeId: QuoteType }),
            contentType: "application/json; charset=utf-8",
            success: function (res) {
                if (res.length > 0) {
                    $("#SearchOrderQuoteNo").empty();
                    $.each(res, function (i, item){
                        $("#SearchOrderQuoteNo").append($('<option></option>').val(item.DataStringValueField).html(item.DataTextField));
                    })
                }
            }
        })
    }

</script>




<script src="~/Scripts/CustomJS/TechItemDetails.js"></script>